FROM python:3.10-slim

WORKDIR /app

# Install runtime dependencies
RUN apt-get update && apt-get install -y --no-install-recommends \
    curl \
    && rm -rf /var/lib/apt/lists/*

# Install Python dependencies via pip (avoid Poetry during container build)
COPY requirements-docker.txt /app/requirements.txt
RUN pip install --no-cache-dir -r /app/requirements.txt && \
    pip install --no-cache-dir uvicorn fastapi sse-starlette

# Copy only what's needed to run the MCP app
# - Python package
COPY src/archon /app/src/archon

# Set PYTHONPATH to locate the package under /app/src
ENV PYTHONPATH="/app:/app/src"

# Expose the port the app runs on
EXPOSE 8100

# Command to run the canonical MCP application (no shim)
CMD ["uvicorn", "archon.archon.services.mcp.mcp_server:app", "--host", "0.0.0.0", "--port", "8100"]
